<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auto Google Form Bot - Multi Page</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">
<div class="max-w-xl w-full bg-white shadow-2xl rounded-2xl p-6">
  <h1 class="text-3xl font-bold text-center text-blue-600 mb-4">ü§ñ Auto Google Form Bot</h1>
  <p class="text-gray-600 text-center mb-6">Sekarang mendukung form multi-page. Entry 1 untuk nama, berikutnya bisa pilih tipe pertanyaan (PG/Essay).</p>

  <div class="space-y-4">
    <!-- Link Form -->
    <div>
      <label class="block text-gray-700 font-medium mb-1">Link Google Form</label>
      <input id="formLink" type="text" placeholder="https://docs.google.com/forms/d/e/.../viewform" class="w-full p-3 border rounded-lg">
    </div>

    <!-- Target & Delay -->
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-gray-700 font-medium mb-1">Target Responden</label>
        <input id="target" type="number" placeholder="50" class="w-full p-3 border rounded-lg">
      </div>
      <div>
        <label class="block text-gray-700 font-medium mb-1">Delay (ms)</label>
        <input id="delay" type="number" placeholder="500" class="w-full p-3 border rounded-lg">
      </div>
    </div>

    <!-- Entry 1 -->
    <div class="border p-3 rounded-lg bg-gray-100">
      <label class="block text-gray-700 font-medium mb-1">Entry ID Pertanyaan 1 (Nama)</label>
      <input id="entry_1" type="text" placeholder="entry.123456789" class="w-full p-2 border rounded mb-2">
      <label class="block text-gray-700 font-medium mb-1">Database Nama (pisahkan koma)</label>
      <input id="namaDB" type="text" placeholder="Dzakwan,Gita,Rian,Sari,Andi" class="w-full p-2 border rounded">
    </div>

    <!-- Pertanyaan lain -->
    <div id="questionsContainer" class="space-y-2 mt-2">
      <div class="border p-3 rounded-lg bg-gray-100">
        <label class="block text-gray-700 font-medium mb-1">Entry ID Pertanyaan 2</label>
        <input id="entry_2" type="text" placeholder="entry.987654321" class="w-full p-2 border rounded mb-1">
        <label class="block text-gray-700 font-medium mb-1">Tipe Pertanyaan</label>
        <select id="type_2" class="w-full p-2 border rounded mb-1">
          <option value="mc">Pilihan Ganda</option>
          <option value="essay">Essay</option>
        </select>
        <input id="data_2" type="text" placeholder="Ya=70,Tidak=30 atau database jawaban" class="w-full p-2 border rounded">
      </div>
      <button onclick="addQuestion()" class="w-full bg-purple-600 text-white py-2 rounded mt-2 hover:bg-purple-700">‚ûï Tambah Pertanyaan</button>
    </div>

    <!-- Tombol Jalankan -->
    <button onclick="startBot()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl shadow-md hover:bg-blue-700 transition">üöÄ Jalankan Bot</button>
  </div>

  <!-- Log Output -->
  <div class="mt-6 bg-gray-100 rounded-lg p-3 h-64 overflow-y-auto text-sm" id="log">
    <p class="text-gray-500">Log akan muncul di sini...</p>
  </div>
</div>

<script>
let questionCount = 2;

function addQuestion() {
  questionCount++;
  const container = document.getElementById("questionsContainer");
  const div = document.createElement("div");
  div.className = "border p-3 rounded-lg bg-gray-100";
  div.innerHTML = `
    <label class="block text-gray-700 font-medium mb-1">Entry ID Pertanyaan ${questionCount}</label>
    <input id="entry_${questionCount}" type="text" placeholder="entry.xxxxx" class="w-full p-2 border rounded mb-1">
    <label class="block text-gray-700 font-medium mb-1">Tipe Pertanyaan</label>
    <select id="type_${questionCount}" class="w-full p-2 border rounded mb-1">
      <option value="mc">Pilihan Ganda</option>
      <option value="essay">Essay</option>
    </select>
    <input id="data_${questionCount}" type="text" placeholder="Ya=70,Tidak=30 atau database jawaban" class="w-full p-2 border rounded">
  `;
  container.insertBefore(div, container.querySelector("button"));
}

async function startBot() {
  const logBox = document.getElementById("log");
  logBox.innerHTML = "<p class='text-blue-600 font-semibold'>üöÄ Mulai submit...</p>";

  const formLink = document.getElementById("formLink").value.trim();
  if (!formLink.includes("/viewform")) {
    logBox.innerHTML += "<p class='text-red-500'>‚ùå Link harus /viewform!</p>";
    return;
  }

  const target = parseInt(document.getElementById("target").value) || 1;
  const delay = parseInt(document.getElementById("delay").value) || 500;
  const formResponseURL = formLink.replace("/viewform","/formResponse");

  // Ambil jawaban
  let answers = {};
  for (let i = 1; i <= questionCount; i++) {
    const entry = document.getElementById(`entry_${i}`).value.trim();
    const type = i===1 ? "essay" : document.getElementById(`type_${i}`).value;
    const data = i===1 ? document.getElementById("namaDB").value : document.getElementById(`data_${i}`).value;
    if (!entry || !data) continue;

    if (type === "mc") {
      const map = {};
      data.split(",").forEach(pair => {
        const [val, pct] = pair.split("=");
        map[val.trim()] = parseInt(pct.trim());
      });
      let arr=[];
      Object.keys(map).forEach(val=>{
        const count = Math.round((map[val]/100)*target);
        for(let j=0;j<count;j++) arr.push(val);
      });
      while(arr.length<target) arr.push(Object.keys(map)[0]);
      answers[entry] = arr.sort(()=>Math.random()-0.5);
    } else {
      let arr = data.split(",").map(s=>s.trim());
      if (arr.length < target) {
        while(arr.length<target) arr.push(arr[Math.floor(Math.random()*arr.length)]);
      }
      answers[entry] = arr.sort(()=>Math.random()-0.5);
    }
  }

  for (let i=0;i<target;i++) {
    const formData = new URLSearchParams();
    Object.keys(answers).forEach(entry=>{
      formData.append(entry, answers[entry][i]);
    });

    try {
      await fetch(formResponseURL, {method:"POST", body:formData, mode:"no-cors"});
      logBox.innerHTML += `<p class='text-green-600'>‚úÖ Respon ke-${i+1} terkirim</p>`;
    } catch (e) {
      logBox.innerHTML += `<p class='text-red-500'>‚ùå Gagal kirim respon ke-${i+1}</p>`;
    }
    logBox.scrollTop = logBox.scrollHeight;
    await new Promise(r=>setTimeout(r,delay));
  }

  logBox.innerHTML += "<p class='text-blue-600 font-semibold'>üéâ Semua respon selesai!</p>";
}
</script>
</body>
</html>
