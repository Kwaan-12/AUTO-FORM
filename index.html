<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Auto Google Form Bot - Hybrid</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">
  <div class="max-w-lg w-full bg-white shadow-2xl rounded-2xl p-6">
    <h1 class="text-3xl font-bold text-center text-blue-600 mb-4">ü§ñ Auto Google Form Bot (Hybrid)</h1>
    <p class="text-gray-600 text-center mb-6">Paste HTML viewform di bawah, bot akan extract entry IDs otomatis.</p>

    <div class="space-y-4">
      <div>
        <label class="block text-gray-700 font-medium mb-1">Paste HTML Google Form</label>
        <textarea id="htmlInput" rows="6" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Paste HTML viewform di sini..."></textarea>
      </div>

      <div>
        <button onclick="extractFields()" class="w-full bg-purple-600 text-white py-3 rounded-xl hover:bg-purple-700">üîç Extract Entry IDs</button>
      </div>

      <div id="fieldsContainer" class="space-y-2"></div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-gray-700 font-medium mb-1">Target Responden</label>
          <input id="target" type="number" placeholder="50" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
        </div>
        <div>
          <label class="block text-gray-700 font-medium mb-1">Delay (ms)</label>
          <input id="delay" type="number" placeholder="500" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
        </div>
      </div>

      <button onclick="startBot()" class="w-full bg-blue-600 text-white py-3 rounded-xl hover:bg-blue-700">üöÄ Jalankan Bot</button>
    </div>

    <div class="mt-6 bg-gray-100 rounded-lg p-3 h-56 overflow-y-auto text-sm" id="log">
      <p class="text-gray-500">Log akan muncul di sini...</p>
    </div>
  </div>

  <script>
    let detectedFields = [];
    let randomAnswers = [];
    let formResponseURL = "";

    function extractFields() {
      const html = document.getElementById("htmlInput").value;
      const container = document.getElementById("fieldsContainer");
      const logBox = document.getElementById("log");
      container.innerHTML = "";
      detectedFields = [];
      randomAnswers = [];

      // Regex untuk mencari entry IDs
      const regex = /name="(entry\.\d+)"/g;
      let match;
      while((match = regex.exec(html)) !== null){
        if(!detectedFields.includes(match[1])) detectedFields.push(match[1]);
      }

      if(detectedFields.length===0){
        logBox.innerHTML += "<p class='text-red-500'>‚ùå Tidak ditemukan entry ID</p>";
        return;
      }

      logBox.innerHTML += `<p class='text-green-600'>‚úÖ Ditemukan ${detectedFields.length} field</p>`;

      detectedFields.forEach((id,i)=>{
        const div = document.createElement("div");
        div.innerHTML = `
          <label class="block text-gray-700 font-medium mb-1">Jawaban Field ${i+1} (${id})</label>
          <input id="field_${id}" type="text" placeholder="Jawaban default" class="w-full p-2 border rounded mb-1">
          <input id="percent_${id}" type="text" placeholder="Persentase jawaban (A=70,B=30)" class="w-full p-2 border rounded">
        `;
        container.appendChild(div);
      });
    }

    async function startBot() {
      const target = parseInt(document.getElementById("target").value)||1;
      const delay = parseInt(document.getElementById("delay").value)||500;
      const logBox = document.getElementById("log");
      formResponseURL = prompt("Masukkan link /viewform yang sesuai");

      if(!formResponseURL.includes("/viewform")){
        logBox.innerHTML += "<p class='text-red-500'>‚ùå Link harus /viewform</p>";
        return;
      }

      formResponseURL = formResponseURL.replace("/viewform","/formResponse");
      logBox.innerHTML += "<p class='text-blue-600 font-semibold'>üöÄ Mulai submit...</p>";

      // Generate jawaban random sesuai persentase
      detectedFields.forEach(id=>{
        const percentInput = document.getElementById(`percent_${id}`).value.trim();
        if(percentInput){
          const map={};
          percentInput.split(',').forEach(pair=>{
            const [val,pct]=pair.split('=');
            if(val && pct) map[val.trim()]=parseInt(pct.trim());
          });
          let arr=[];
          Object.keys(map).forEach(val=>{
            const count=Math.round((map[val]/100)*target);
            for(let i=0;i<count;i++) arr.push(val);
          });
          while(arr.length<target) arr.push(Object.keys(map)[0]);
          for(let i=arr.length-1;i>0;i--){
            const j=Math.floor(Math.random()*(i+1));
            [arr[i],arr[j]]=[arr[j],arr[i]];
          }
          randomAnswers[id]=arr;
        }else{
          const defaultVal = document.getElementById(`field_${id}`).value||"Jawaban";
          randomAnswers[id]=Array(target).fill(defaultVal);
        }
      });

      // Submit setiap respon
      for(let i=0;i<target;i++){
        const formData = new URLSearchParams();
        Object.keys(randomAnswers).forEach(entry=>{
          formData.append(entry,randomAnswers[entry][i]);
        });
        try{
          await fetch(formResponseURL,{method:"POST",body:formData,mode:"no-cors"});
          logBox.innerHTML += `<p class='text-green-600'>‚úÖ Respon ke-${i+1} terkirim!</p>`;
        }catch(err){
          logBox.innerHTML += `<p class='text-red-500'>‚ùå Gagal kirim respon ke-${i+1}</p>`;
        }
        logBox.scrollTop = logBox.scrollHeight;
        await new Promise(r=>setTimeout(r,delay));
      }

      logBox.innerHTML += "<p class='text-blue-600 font-semibold'>üéâ Semua respon selesai!</p>";
    }
  </script>
</body>
</html>
