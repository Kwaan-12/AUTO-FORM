<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auto Google Form Bot - Multi Page</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">
<div class="max-w-2xl w-full bg-white shadow-2xl rounded-2xl p-6">
  <h1 class="text-3xl font-bold text-center text-blue-600 mb-4">ü§ñ Auto Google Form Bot - Multi Page</h1>
  <p class="text-gray-600 text-center mb-6">Entry 1 akan diisi random dari database nama unik. Pertanyaan lain bisa MC/Essay/Dropdown.</p>

  <div class="space-y-4">
    <!-- Link Form -->
    <div>
      <label class="block text-gray-700 font-medium mb-1">Link Google Form</label>
      <input id="formLink" type="text" placeholder="https://docs.google.com/forms/d/e/.../viewform" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
    </div>

    <!-- Target & Delay -->
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-gray-700 font-medium mb-1">Target Responden</label>
        <input id="target" type="number" placeholder="50" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
      </div>
      <div>
        <label class="block text-gray-700 font-medium mb-1">Delay per Responden (ms)</label>
        <input id="delay" type="number" placeholder="500" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
      </div>
    </div>

    <!-- Entry 1 -->
    <div class="border p-3 rounded-lg bg-gray-100">
      <label class="block text-gray-700 font-medium mb-1">Entry ID Pertanyaan 1 (Nama)</label>
      <input id="entry_1" type="text" placeholder="entry.123456789" class="w-full p-2 border rounded mb-2">
      <label class="block text-gray-700 font-medium mb-1">Database Nama (pisahkan koma)</label>
      <input id="namaDB" type="text" placeholder="Dzakwan,Gita,Rian,Sari,Andi" class="w-full p-2 border rounded">
    </div>

    <!-- Pertanyaan lain -->
    <div id="questionsContainer" class="space-y-2 mt-2">
      <div class="border p-3 rounded-lg bg-gray-100">
        <label class="block text-gray-700 font-medium mb-1">Entry ID Pertanyaan 2</label>
        <input id="entry_2" type="text" placeholder="entry.xxxxx" class="w-full p-2 border rounded mb-1">
        <select id="type_2" class="w-full p-2 border rounded mb-1">
          <option value="mc">Pilihan Ganda / Dropdown</option>
          <option value="essay">Essay / Teks</option>
        </select>
        <input id="percent_2" type="text" placeholder="MC: Ya=70,Tidak=30 | Essay: Jawaban1,Jawaban2" class="w-full p-2 border rounded">
      </div>
      <button onclick="addQuestion()" class="w-full bg-purple-600 text-white py-2 rounded mt-2 hover:bg-purple-700">‚ûï Tambah Pertanyaan</button>
    </div>

    <!-- Tombol Jalankan -->
    <button onclick="startBot()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl shadow-md hover:bg-blue-700 transition">üöÄ Jalankan Bot</button>
  </div>

  <!-- Log Output -->
  <div class="mt-6 bg-gray-100 rounded-lg p-3 h-64 overflow-y-auto text-sm" id="log">
    <p class="text-gray-500">Log akan muncul di sini...</p>
  </div>
</div>

<script>
let questionCount = 2; // entry 1 = Nama, entry 2 default pertanyaan lain
let randomAnswers = {};

function addQuestion() {
  questionCount++;
  const container = document.getElementById("questionsContainer");

  const div = document.createElement("div");
  div.className = "border p-3 rounded-lg bg-gray-100 mb-2";
  div.innerHTML = `
    <label class="block text-gray-700 font-medium mb-1">Entry ID Pertanyaan ${questionCount}</label>
    <input id="entry_${questionCount}" type="text" placeholder="entry.xxxxx" class="w-full p-2 border rounded mb-1">
    <select id="type_${questionCount}" class="w-full p-2 border rounded mb-1">
      <option value="mc">Pilihan Ganda / Dropdown</option>
      <option value="essay">Essay / Teks</option>
    </select>
    <input id="percent_${questionCount}" type="text" placeholder="MC: Ya=70,Tidak=30 | Essay: Jawaban1,Jawaban2" class="w-full p-2 border rounded">
  `;

  const addButton = container.querySelector("button");
  container.insertBefore(div, addButton);
}

async function startBot() {
  const target = parseInt(document.getElementById("target").value) || 1;
  const delay = parseInt(document.getElementById("delay").value) || 500;
  const formLink = document.getElementById("formLink").value.trim();
  const logBox = document.getElementById("log");
  const namaDB = document.getElementById("namaDB").value.split(',').map(s=>s.trim()).filter(s=>s);
  logBox.innerHTML = "<p class='text-blue-600 font-semibold'>üöÄ Mulai submit...</p>";

  if (!formLink.includes("/viewform")) {
    logBox.innerHTML += "<p class='text-red-500'>‚ùå Link harus /viewform!</p>";
    return;
  }
  if(namaDB.length===0){
    logBox.innerHTML += "<p class='text-red-500'>‚ùå Database nama kosong!</p>";
    return;
  }

  const formResponseURL = formLink.replace("/viewform","/formResponse");

  // Entry 1 = Nama (nama unik)
  const entryIdNama = document.getElementById("entry_1").value.trim();
  if(!entryIdNama){
    logBox.innerHTML += "<p class='text-red-500'>‚ùå Entry ID Nama kosong!</p>";
    return;
  }

  let availableNames = [...namaDB];
  if(target > availableNames.length){
    logBox.innerHTML += "<p class='text-red-500'>‚ùå Target responden lebih besar dari jumlah nama!</p>";
    return;
  }

  let arrNama = [];
  for(let j=0;j<target;j++){
    const idx = Math.floor(Math.random()*availableNames.length);
    arrNama.push(availableNames[idx]);
    availableNames.splice(idx,1);
  }
  randomAnswers[entryIdNama] = arrNama;

  // Pertanyaan lain
  for(let i=2;i<=questionCount;i++){
    const entryId = document.getElementById(`entry_${i}`).value.trim();
    const type = document.getElementById(`type_${i}`).value;
    const valInput = document.getElementById(`percent_${i}`).value.trim();

    if(!entryId || !valInput){
      logBox.innerHTML += `<p class='text-red-500'>‚ùå Entry ID atau jawaban pertanyaan ${i} kosong!</p>`;
      return;
    }

    let arr=[];
    if(type==="mc"){
      const map={};
      valInput.split(',').forEach(pair=>{
        const [v,p]=pair.split('=');
        if(v && p) map[v.trim()]=parseInt(p.trim());
      });
      Object.keys(map).forEach(v=>{
        const count = Math.round((map[v]/100)*target);
        for(let j=0;j<count;j++) arr.push(v);
      });
      while(arr.length<target) arr.push(Object.keys(map)[0]);
    } else {
      arr = valInput.split(',').map(s=>s.trim());
      while(arr.length<target) arr.push(arr[0]);
      arr = arr.slice(0,target);
      for(let j=arr.length-1;j>0;j--){
        const k=Math.floor(Math.random()*(j+1));
        [arr[j],arr[k]]=[arr[k],arr[j]];
      }
    }
    randomAnswers[entryId]=arr
  }

  // Submit tiap respon (multi-page otomatis)
  for(let i=0;i<target;i++){
    const formData = new URLSearchParams();
    Object.keys(randomAnswers).forEach(entry=>{
      formData.append(entry, randomAnswers[entry][i]);
    });

    try{
      await fetch(formResponseURL,{method:"POST",body:formData,mode:"no-cors"});
      logBox.innerHTML += `<p class='text-green-600'>‚úÖ Respon ke-${i+1} terkirim! (${JSON.stringify(Object.keys(randomAnswers).map(e=>randomAnswers[e][i]))})</p>`;
    }catch(err){
      logBox.innerHTML += `<p class='text-red-500'>‚ùå Gagal kirim respon ke-${i+1}</p>`;
    }

    logBox.scrollTop = logBox.scrollHeight;
    await new Promise(r=>setTimeout(r,delay));
  }

  logBox.innerHTML += "<p class='text-blue-600 font-semibold'>üéâ Semua respon selesai!</p>";
}
</script>
</body>
</html>
